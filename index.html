<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Klik Barang & Pilih Jumlah</title>
  <style>
    :root{--bg:#f4f6f8;--card:#fff;--accent:#2b8aef;--muted:#666;}
    body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);color:#111;}
    header{padding:16px 24px;background:linear-gradient(90deg,#fff,#f7fbff);box-shadow:0 2px 6px rgba(0,0,0,0.04);}
    header h1{margin:0;font-size:18px;}
    main{display:flex;gap:20px;padding:20px;}
    .left{flex:1;min-width:0;}
    .search-box{margin-bottom:12px;}
    input[type="text"]{width:100%;padding:10px 12px;border:1px solid #d7e2f0;border-radius:10px;font-size:15px;box-sizing:border-box;background:#fff;}
    table{width:100%;border-collapse:collapse;background:var(--card);border-radius:8px;overflow:hidden;box-shadow:0 2px 6px rgba(0,0,0,0.04);}
    th,td{padding:10px 12px;text-align:left;border-bottom:1px solid #f1f5f9;font-size:14px;}
    th{background:#fbfdff;font-weight:600;color:var(--muted);}
    tr.item-row{cursor:pointer;transition:background .12s ease;}
    tr.item-row:hover{background:#f7fbff;}
    .right{width:360px;max-width:40%;min-width:280px;display:flex;flex-direction:column;gap:12px;}
    .card{background:var(--card);padding:14px;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,0.04);}
    .cart-list{max-height:260px;overflow:auto;}
    .cart-item{display:flex;gap:8px;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px dashed #f0f3f7;}
    .cart-item:last-child{border-bottom:none;}
    .qty-input{width:64px;padding:6px;border-radius:8px;border:1px solid #e3e8ef;text-align:center;}
    .btn{background:var(--accent);color:#fff;padding:6px 10px;border-radius:6px;border:none;cursor:pointer;font-weight:600;font-size:13px;}
    .btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(43,138,239,0.16);}
    .small{font-size:12px;padding:6px 8px;border-radius:6px;}
    .total-row{display:flex;justify-content:space-between;align-items:center;margin-top:8px;font-weight:700;font-size:16px;}
    .empty{color:var(--muted);text-align:center;padding:28px 8px;}
    .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.35);z-index:40;visibility:hidden;opacity:0;transition:opacity .12s ease,visibility .12s;}
    .modal.show{visibility:visible;opacity:1;}
    .modal .box{background:var(--card);padding:18px;border-radius:12px;min-width:320px;box-shadow:0 10px 30px rgba(0,0,0,0.18);}
    .muted{color:var(--muted);font-size:13px;}
    @media(max-width:900px){main{flex-direction:column;}.right{width:100%;max-width:none;}}
  </style>
</head>
<body>
  <header><h1>Klik Barang Dan Pilih Jumlah Barang</h1></header>
  <main>
    <section class="left">
      <div class="search-box"><input type="text" id="search" placeholder="Ketik nama barang..."></div>
      <table id="stokTable" aria-label="Daftar stok">
        <thead><tr><th style="width:48px">No</th><th>Nama</th><th style="width:96px">Stock</th><th style="width:140px">Harga Jual</th></tr></thead>
        <tbody id="stokBody"></tbody>
      </table>
    </section>
    <aside class="right">
      <div class="card"><div style="display:flex;justify-content:space-between;align-items:center"><div style="font-weight:700">Keranjang</div><div class="muted" id="cartCount">0 item</div></div></div>
      <div class="card cart-list" id="cartList"><div class="empty" id="cartEmpty">Keranjang kosong — tambahkan barang dari daftar.</div></div>
      <div class="card"><div class="total-row"><div>Total</div><div id="totalAmount">Rp 0</div></div><div style="display:flex;gap:8px;margin-top:12px;"><button class="btn" id="checkoutBtn">Checkout</button><button class="btn ghost" id="clearBtn">Clear</button></div></div>
      <div class="card" id="historyCard"><div style="font-weight:700">Histori Transaksi</div><div id="historyList" class="muted" style="margin-top:6px;font-size:14px;">Belum ada transaksi.</div></div>
    </aside>
  </main>
  <div class="modal" id="qtyModal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="box"><div style="font-weight:700" id="modalTitle">Pilih jumlah</div><div class="muted" id="modalStock" style="margin-top:6px">Stok: -</div><div style="margin-top:12px;display:flex;gap:8px;align-items:center;"><button id="decBtn" class="small">-</button><input type="number" id="modalQty" class="qty-input" min="1" value="1"/><button id="incBtn" class="small">+</button></div><div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px;"><button class="btn ghost" id="modalCancel">Batal</button><button class="btn" id="modalAdd">Tambah ke Keranjang</button></div></div>
  </div>

  <script>
    const data = [
  {no:1, nama:"Akumo Nuget Ayam 500 Gram", stock:10, harga:24000},
  {no:2, nama:"Ardena Kaki naga 500 Gram", stock:24, harga:27000},
  {no:3, nama:"Asimo Nugget Kombinasi 1 KG", stock:5, harga:35000},
  {no:4, nama:"Bakso Ayam 500 Gram", stock:5, harga:17000},
  {no:5, nama:"Benardi Roti Burger wijen @6s", stock:18, harga:19000},
  {no:6, nama:"Brecxelle Rujak Cireng Original", stock:25, harga:15000},
  {no:7, nama:"Camp Cruncy Nugget 450 Gram", stock:12, harga:27000},
  {no:8, nama:"Cedea Baso Salmon 500 Gram", stock:24, harga:29000},
  {no:9, nama:"Cedea Fish Dumpling Cheses 500 Gram", stock:24, harga:29000},
  {no:10, nama:"Cedea Fish Dumpling Chiken 500 Gram", stock:24, harga:29000},
  {no:11, nama:"Cedea Fish Roll 500 Gram", stock:20, harga:16000},
  {no:12, nama:"Cedea Stemboat 300 Gram", stock:20, harga:22000},
  {no:13, nama:"Chiken Nugget 500 Gram", stock:5, harga:35000},
  {no:14, nama:"Cedea Cikua Mini 500 Gram", stock:12, harga:29000},
  {no:15, nama:"Crispy Chiken Burger 315 gram", stock:10, harga:18000},
  {no:16, nama:"Damory Piscok Lumer @10 S", stock:20, harga:15000},
  {no:17, nama:"Del Monte Barbaque 250 Gram", stock:24, harga:11000},
  {no:18, nama:"Delon Makaroni 1 Kg", stock:10, harga:22000},
  {no:19, nama:"Dua Belibis Value Saus cabe 1 Kg", stock:10, harga:26000},
  {no:20, nama:"Fiesta Crispy Bubble Nugget 400 Gram", stock:12, harga:35000},
  {no:21, nama:"Fiesta Frenh fries Straight Cut 500 Gram", stock:12, harga:22000},
  {no:22, nama:"Fiesta Pizz ABC 400 Gram", stock:12, harga:40000},
  {no:23, nama:"Fiesta Pok pok 400 Gram", stock:12, harga:43000},
  {no:24, nama:"Fris Flag UHT Full Cream 225 ML", stock:27, harga:10000},
  {no:25, nama:"Goboooyku Sosis Ayam 1 Kg", stock:10, harga:35000},
  {no:26, nama:"Hemanto Nuget Mix 500 Gram", stock:12, harga:18000},
  {no:27, nama:"Home Crincle Cut 1 Kg", stock:10, harga:37000},
  {no:28, nama:"Jagung Manis Pipil 1 Kg", stock:10, harga:23000},
  {no:29, nama:"Kanzeler Beef Coktail 500 Gram", stock:20, harga:56000},
  {no:30, nama:"Kanzeler Sosis Singles hot 65 gram", stock:10, harga:94000},
  {no:31, nama:"Kanzeler Sosis Single Original 65 gram", stock:5, harga:94000},
  {no:32, nama:"Kemasan Burger @50 s", stock:20, harga:16000},
  {no:33, nama:"Kemasan kebab Hijau Besar @50s", stock:10, harga:26000},
  {no:34, nama:"Kemasan Kebab Hijau kecil @50 s", stock:10, harga:24000},
  {no:35, nama:"La Fonte Bolognese 315 Gram", stock:20, harga:19000},
  {no:36, nama:"Lipao Coklat 430 Gram", stock:12, harga:15000},
  {no:37, nama:"Maestro Mayonise 1 Kg", stock:10, harga:32000},
  {no:38, nama:"Maestro Mayonise 180 Gram", stock:24, harga:9000},
  {no:39, nama:"Mama bawang merah goreng 50gr", stock:12, harga:15000},
  {no:40, nama:"Mama bumbu Mala Hot pot 50 Gram", stock:20, harga:7000},
  {no:41, nama:"Mama Bumbu Rendang 50 gram", stock:20, harga:7000},
  {no:42, nama:"Mama Bumbu saos Mentai", stock:20, harga:7000},
  {no:43, nama:"Mama bumbu Tom yam Pasie 50 gram", stock:20, harga:9000},
  {no:44, nama:"Mamayo Mayonise 1 Kg", stock:12, harga:24000},
  {no:45, nama:"Mamu Bumsu Suki", stock:20, harga:7000},
  {no:46, nama:"Max Choice Sosis Mini orginal 500 Gram", stock:16, harga:29000},
  {no:47, nama:"Mc Lewis mayonise 500 gram", stock:12, harga:26000},
  {no:48, nama:"Miitraku Dumpling Ayam 500 Gram", stock:20, harga:27000},
  {no:49, nama:"Mister Max sosbak mini ayam 500 Gram", stock:16, harga:26000},
  {no:50, nama:"Mitraku Mixfurray 500 Gram", stock:20, harga:25000},
  {no:51, nama:"Mitraku Stemoat Tomyam 300 Gram", stock:20, harga:21000},
  {no:52, nama:"Mr Moof Roti Goreng Coklat 10 S", stock:12, harga:27000},
  {no:53, nama:"My Heatthy Youghut @20 S", stock:10, harga:15000},
  {no:54, nama:"My Heatthy Youghut @30 S", stock:10, harga:14000},
  {no:55, nama:"Ngejos Nugget ayam 1 Kg", stock:5, harga:34000},
  {no:56, nama:"Ngejos Sosis Ayam 1 Kg", stock:10, harga:32000},
  {no:57, nama:"Nipao Coklat @30 480 gram", stock:12, harga:15000},
  {no:58, nama:"Okey Nugget Ayam 500 Gram", stock:10, harga:22000},
  {no:59, nama:"Pelangi Donat @21 S", stock:10, harga:19000},
  {no:60, nama:"Pelangi Jely 500 Gram", stock:25, harga:8000},
  {no:61, nama:"Proteina Ls 250 gram", stock:24, harga:13000},
  {no:62, nama:"RD Bakso Brekele @5", stock:10, harga:17000},
  {no:63, nama:"RD Bakso SB @50", stock:10, harga:35000},
  {no:64, nama:"Saos Tiram Botol 133 ML", stock:24, harga:12000},
  {no:65, nama:"Sasa sambal Asli @48 s 9 gram (polos)", stock:20, harga:12000},
  {no:66, nama:"sedani Makaroni Pipa 1 Kg", stock:10, harga:20000},
  {no:67, nama:"Sedani Spageti 1 Kg", stock:10, harga:24000},
  {no:68, nama:"Segitiga Biru Tepun Terigu 1 Kg", stock:12, harga:14000},
  {no:69, nama:"Shifudo Siomay ikan 500gram", stock:24, harga:19000},
  {no:70, nama:"Sosis Ayam 950 gram", stock:5, harga:37000},
  {no:71, nama:"Sunfish Crab tick 500 gram", stock:24, harga:28000},
  {no:72, nama:"Tasty Max Cocktail Ory 500 Gram", stock:15, harga:37000},
  {no:73, nama:"Umiami Minipao Ayam 30s", stock:12, harga:14000},
  {no:74, nama:"Vitalia Burger sapi 280 Gram", stock:24, harga:11000},
  {no:75, nama:"Warisan 319 Bakso Super M-50s", stock:10, harga:27000},
  {no:76, nama:"Warisan 319 Bakso Urat M-50s", stock:10, harga:26000},
  {no:77, nama:"Yona Sosis Sapi bakar mini 500 gram", stock:20, harga:35000},
  {no:78, nama:"Nugget So Eco 1 KG", stock:6, harga:32000},
  {no:79, nama:"Chiken Spicy Wings", stock:24, harga:35000},
  {no:80, nama:"Ceker 1 KG", stock:20, harga:10000},
  {no:81, nama:"Ceker Tanpa Tulang 1 KG", stock:20, harga:38000},
    ];

    const cart=new Map();
    const history=[];

    const stokBody=document.getElementById("stokBody"),search=document.getElementById("search"),cartList=document.getElementById("cartList"),cartCount=document.getElementById("cartCount"),cartEmpty=document.getElementById("cartEmpty"),totalAmount=document.getElementById("totalAmount"),checkoutBtn=document.getElementById("checkoutBtn"),clearBtn=document.getElementById("clearBtn"),qtyModal=document.getElementById("qtyModal"),modalTitle=document.getElementById("modalTitle"),modalStock=document.getElementById("modalStock"),modalQty=document.getElementById("modalQty"),modalAdd=document.getElementById("modalAdd"),modalCancel=document.getElementById("modalCancel"),incBtn=document.getElementById("incBtn"),decBtn=document.getElementById("decBtn"),historyList=document.getElementById("historyList");

    let activeItem=null;
    function formatRupiah(x){return 'Rp '+x.toLocaleString('id-ID');}

    function renderTable(filter=""){
      stokBody.innerHTML="";
      const keyword=filter.toLowerCase();
      const filtered=data.filter(item=>item.nama.toLowerCase().includes(keyword));
      if(filtered.length===0){
        stokBody.innerHTML=`<tr><td colspan="4" style="text-align:center;padding:18px;color:var(--muted)">Tidak ditemukan</td></tr>`;
        return;
      }
      filtered.forEach(item=>{
        const tr=document.createElement("tr");
        tr.className="item-row";
        tr.innerHTML=`<td>${item.no}</td><td>${item.nama}</td><td>${item.stock}</td><td>${formatRupiah(item.harga)}</td>`;
        tr.addEventListener("click",()=>onClickItem(item));
        stokBody.appendChild(tr);
      });
    }

    function onClickItem(item){
      if(item.stock<=0){alert('Stok habis untuk: '+item.nama);return;}
      activeItem=item;
      modalTitle.textContent=item.nama;
      modalStock.textContent=`Stok tersedia: ${item.stock}`;
      modalQty.value=1;modalQty.min=1;modalQty.max=item.stock;
      qtyModal.classList.add('show');qtyModal.setAttribute('aria-hidden','false');
    }
    function closeModal(){qtyModal.classList.remove('show');qtyModal.setAttribute('aria-hidden','true');activeItem=null;}
    incBtn.addEventListener("click",()=>{let v=+modalQty.value||1;if(v<+modalQty.max)modalQty.value=v+1;});
    decBtn.addEventListener("click",()=>{let v=+modalQty.value||1;if(v>1)modalQty.value=v-1;});
    modalCancel.addEventListener("click",closeModal);
    qtyModal.addEventListener("click",(e)=>{if(e.target===qtyModal)closeModal();});
    modalAdd.addEventListener("click",()=>{const qty=Math.max(1,Math.min(+modalQty.value,+modalQty.max));addToCart(activeItem,qty);closeModal();});

    function addToCart(item,qty){
      const existing=cart.get(item.no);
      const newQty=(existing?existing.qty:0)+qty;
      if(newQty>item.stock){alert('Jumlah melebihi stok tersedia.');return;}
      cart.set(item.no,{item,qty:newQty});
      renderCart();
    }

    function renderCart(){
      cartList.innerHTML='';
      if(cart.size===0){cartList.appendChild(cartEmpty);cartCount.textContent='0 item';totalAmount.textContent=formatRupiah(0);return;}
      cartCount.textContent=`${[...cart.values()].reduce((s,v)=>s+v.qty,0)} item`;
      let total=0;
      cart.forEach(({item,qty})=>{
        total+=item.harga*qty;
        const div=document.createElement('div');div.className='cart-item';
        div.innerHTML=`
          <div style="flex:1">
            <div style="font-weight:600">${item.nama}</div>
            <div class="muted" style="font-size:12px;margin-top:4px">${formatRupiah(item.harga)} • Stok: ${item.stock}</div>
          </div>
          <div style="display:flex;flex-direction:column;align-items:flex-end;gap:6px">
            <div style="display:flex;gap:6px;align-items:center">
              <button class="small">-</button>
              <input type="number" class="qty-input" value="${qty}" min="1" max="${item.stock}">
              <button class="small">+</button>
            </div>
            <div style="font-weight:700">${formatRupiah(item.harga*qty)}</div>
          </div>
          <button class="small" style="border:none;background:transparent;color:#c33;cursor:pointer">×</button>
        `;
        const [minus,input,plus,remove]=div.querySelectorAll("button,input");
        minus.addEventListener("click",()=>updateQty(item.no,qty-1));
        plus.addEventListener("click",()=>updateQty(item.no,qty+1));
        input.addEventListener("change",e=>{let val=+e.target.value||1;val=Math.max(1,Math.min(val,item.stock));updateQty(item.no,val);});
        remove.addEventListener("click",()=>removeFromCart(item.no));
        cartList.appendChild(div);
      });
      totalAmount.textContent=formatRupiah(total);
    }
    function updateQty(no,qty){const entry=cart.get(no);if(!entry)return;if(qty<=0){cart.delete(no);}else if(qty>entry.item.stock){alert('Melebihi stok tersedia.');return;}else{cart.set(no,{item:entry.item,qty});}renderCart();}
    function removeFromCart(no){cart.delete(no);renderCart();}
    clearBtn.addEventListener('click',()=>{if(confirm('Kosongkan keranjang?')){cart.clear();renderCart();}});

    function renderHistory(){
      historyList.innerHTML="";
      if(history.length===0){historyList.textContent="Belum ada transaksi.";return;}
      const grouped={};
      history.forEach(trx=>{
        const dateKey=new Date(trx.date).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"});
        if(!grouped[dateKey]) grouped[dateKey]=[];
        grouped[dateKey].push(trx);
      });
      Object.keys(grouped).reverse().forEach(dateKey=>{
        const section=document.createElement("div");section.style.marginBottom="14px";
        const header=document.createElement("div");
        header.style.display="flex";header.style.justifyContent="space-between";header.style.alignItems="center";header.style.marginBottom="6px";
        header.innerHTML=`<div style="font-weight:700">${dateKey}</div>`;
        const delBtn=document.createElement("button");delBtn.className="btn ghost";delBtn.textContent="Hapus semua";delBtn.style.fontSize="11px";delBtn.addEventListener("click",()=>deleteHistoryByDate(dateKey));
        header.appendChild(delBtn);section.appendChild(header);
        grouped[dateKey].slice().reverse().forEach(trx=>{
          const div=document.createElement("div");div.style.border="1px solid #eee";div.style.borderRadius="8px";div.style.padding="8px";div.style.marginBottom="8px";div.style.background="#fafafa";
          const time=new Date(trx.date).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"});
          div.innerHTML=`
            <div style="font-weight:600">Jam ${time}</div>
            <ul style="margin:6px 0 0 16px; padding:0; font-size:13px; color:#444">
              ${trx.items.map(i=>`<li>${i.nama} x${i.qty} = ${formatRupiah(i.subtotal)}</li>`).join("")}
            </ul>
            <div style="font-weight:700; margin-top:6px">Total: ${formatRupiah(trx.total)}</div>
          `;
          section.appendChild(div);
        });
        historyList.appendChild(section);
      });
    }

    function deleteHistoryByDate(dateKey){
      if(!confirm("Hapus semua transaksi pada "+dateKey+"?")) return;
      const remain=history.filter(trx=>{
        const d=new Date(trx.date).toLocaleDateString("id-ID",{year:"numeric",month:"long",day:"numeric"});
        return d!==dateKey;
      });
      history.length=0;history.push(...remain);
      saveHistory();renderHistory();
    }

    function saveHistory(){localStorage.setItem("history",JSON.stringify(history));}
    function loadHistory(){
      const saved=localStorage.getItem("history");if(!saved)return;
      const parsed=JSON.parse(saved);
      const now=Date.now(),sevenDays=7*24*60*60*1000;
      parsed.forEach(trx=>{if(now-trx.date<=sevenDays){history.push(trx);}});
      renderHistory();
    }

    checkoutBtn.addEventListener('click',()=>{
      if(cart.size===0){alert('Keranjang kosong.');return;}
      let items=[],total=0;
      cart.forEach(({item,qty})=>{
        const idx=data.findIndex(d=>d.no===item.no);
        if(idx!==-1)data[idx].stock=Math.max(0,data[idx].stock-qty);
        const subtotal=item.harga*qty;
        items.push({nama:item.nama,qty,subtotal});
        total+=subtotal;
      });
      history.push({date:Date.now(),items,total});
      saveHistory();
      alert('Checkout berhasil — stok diperbarui & struk disimpan.');
      cart.clear();renderCart();renderTable(search.value);renderHistory();
    });

    search.addEventListener('input',(e)=>renderTable(e.target.value));

    loadHistory();renderTable();
  </script>
</body>
</html>